---
interface Props {
	imageUrl: string;
	onClose: string; // JavaScript function name as string
}

const { imageUrl, onClose } = Astro.props;
---

<div class="image-modal" id="imageModal" onclick={`if(event.target === this) ${onClose}()`}>
	<div class="image-modal__content">
		<button class="image-modal__close" onclick={onClose} aria-label="关闭">
			<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<line x1="18" y1="6" x2="6" y2="18"></line>
				<line x1="6" y1="6" x2="18" y2="18"></line>
			</svg>
		</button>
		<img class="image-modal__image" src={imageUrl} alt="礼物图片" id="modalImage" />
	</div>
</div>

<script>
	function closeImageModal() {
		const modal = document.getElementById('imageModal');
		if (modal) {
			modal.classList.remove('active');
			document.body.style.overflow = '';
		}
	}

	function showImageModal(imageUrl: string) {
		const modal = document.getElementById('imageModal');
		const image = document.getElementById('modalImage') as HTMLImageElement;
		if (modal && image) {
			image.src = imageUrl;
			modal.classList.add('active');
			document.body.style.overflow = 'hidden';
		}
	}

	// 导出函数供外部使用
	declare global {
		interface Window {
			closeImageModal: () => void;
			showImageModal: (imageUrl: string) => void;
		}
	}

	window.closeImageModal = closeImageModal;
	window.showImageModal = showImageModal;

	// ESC 键关闭
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape') {
			closeImageModal();
		}
	});
</script>

<style>
	.image-modal {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.85);
		backdrop-filter: blur(8px);
		display: flex;
		justify-content: center;
		align-items: center;
		z-index: 10000;
		opacity: 0;
		visibility: hidden;
		transition: all 0.3s ease;
	}

	.image-modal.active {
		opacity: 1;
		visibility: visible;
	}

	.image-modal__content {
		position: relative;
		max-width: 90vw;
		max-height: 90vh;
		background: #fff;
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
		transform: scale(0.9);
		transition: transform 0.3s ease;
	}

	.image-modal.active .image-modal__content {
		transform: scale(1);
	}

	.image-modal__close {
		position: absolute;
		top: 12px;
		right: 12px;
		width: 40px;
		height: 40px;
		background: rgba(0, 0, 0, 0.6);
		border: none;
		border-radius: 50%;
		color: #fff;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 1;
		transition: all 0.2s ease;
	}

	.image-modal__close:hover {
		background: rgba(0, 0, 0, 0.8);
		transform: rotate(90deg);
	}

	.image-modal__close svg {
		width: 24px;
		height: 24px;
	}

	.image-modal__image {
		display: block;
		max-width: 100%;
		max-height: 90vh;
		width: auto;
		height: auto;
		object-fit: contain;
	}
</style>

