---
import ChristmasTree from "../src/ChristmasTree.astro";
import GiftBox from "../src/GiftBox.astro";
import ImageModal from "../src/ImageModal.astro";
import ChristmasMusic from "../src/ChristmasMusic.astro";
import { giftBoxes, backgroundMusic } from "../src/christmasConfig";

// åˆ›å»ºç¤¼ç›’IDåˆ°å›¾ç‰‡è·¯å¾„çš„æ˜ å°„ï¼Œä¾›å®¢æˆ·ç«¯ä½¿ç”¨
const giftImageMap: Record<string, string> = {};
giftBoxes.forEach(gift => {
	giftImageMap[gift.id] = gift.image;
});
const giftImageMapJson = JSON.stringify(giftImageMap);
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>åœ£è¯ä¸»é¢˜é¡µé¢</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
			background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%);
			min-height: 100vh;
			overflow-x: hidden;
			position: relative;
		}

		/* é›ªèŠ±åŠ¨ç”» */
		.snowflakes {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 1;
			overflow: hidden;
		}

		.snowflake {
			position: absolute;
			color: #fff;
			font-size: 1em;
			font-family: Arial;
			text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
			animation: snowfall linear infinite;
			opacity: 0.8;
		}

		@keyframes snowfall {
			0% {
				transform: translateY(-100vh) rotate(0deg);
				opacity: 0;
			}
			10% {
				opacity: 0.8;
			}
			90% {
				opacity: 0.8;
			}
			100% {
				transform: translateY(100vh) rotate(360deg);
				opacity: 0;
			}
		}

		/* ä¸»å®¹å™¨ */
		.main-container {
			position: relative;
			width: 100%;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 20px;
			z-index: 2;
		}

		/* æ ‡é¢˜ */
		.page-title {
			color: #fff;
			font-size: 2.5rem;
			margin-bottom: 30px;
			text-align: center;
			text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
			animation: title-glow 2s ease-in-out infinite;
		}

		@keyframes title-glow {
			0%, 100% {
				text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
			}
			50% {
				text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6);
			}
		}

		/* åœºæ™¯å®¹å™¨ */
		.scene-container {
			position: relative;
			width: 100%;
			max-width: 1200px;
			height: 80vh;
			min-height: 600px;
		}

		/* å“åº”å¼è®¾è®¡ */
		@media (max-width: 768px) {
			.page-title {
				font-size: 1.8rem;
				margin-bottom: 20px;
			}

			.scene-container {
				height: 70vh;
				min-height: 500px;
			}
		}
	</style>
</head>
<body>
	<!-- é›ªèŠ±åŠ¨ç”» -->
	<div class="snowflakes" id="snowflakes"></div>

	<!-- ä¸»å®¹å™¨ -->
	<div class="main-container">
		<h1 class="page-title">ğŸ„ åœ£è¯å¿«ä¹ ğŸ„</h1>
		
		<!-- åœºæ™¯å®¹å™¨ -->
		<div class="scene-container">
			<!-- åœ£è¯æ ‘ -->
			<ChristmasTree />

			<!-- ç¤¼ç›’ -->
			{giftBoxes.map((gift) => (
				<GiftBox gift={gift} />
			))}
		</div>
	</div>

	<!-- å›¾ç‰‡æ¨¡æ€æ¡† -->
	<ImageModal imageUrl="" onClose="window.closeImageModal" />

	<!-- èƒŒæ™¯éŸ³ä¹ -->
	<ChristmasMusic musicUrl={backgroundMusic} />

	<script define:vars={{ giftImageMapJson }}>
		// ç”Ÿæˆé›ªèŠ±
		function createSnowflakes() {
			const snowflakesContainer = document.getElementById('snowflakes');
			if (!snowflakesContainer) return;

			const snowflakeSymbols = ['â„', 'â…', 'â†', 'âœ»', 'âœ¼', 'â‰'];
			const numSnowflakes = 50;

			for (let i = 0; i < numSnowflakes; i++) {
				const snowflake = document.createElement('div');
				snowflake.className = 'snowflake';
				snowflake.textContent = snowflakeSymbols[Math.floor(Math.random() * snowflakeSymbols.length)];
				snowflake.style.left = Math.random() * 100 + '%';
				snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
				snowflake.style.animationDelay = Math.random() * 2 + 's';
				snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
				snowflakesContainer.appendChild(snowflake);
			}
		}

		// ç¤¼ç›’ç‚¹å‡»äº‹ä»¶
		document.addEventListener('DOMContentLoaded', () => {
			createSnowflakes();

			// ä»æœåŠ¡ç«¯é…ç½®è·å–å›¾ç‰‡è·¯å¾„æ˜ å°„
			const giftImageMap = JSON.parse(giftImageMapJson);

			const giftBoxes = document.querySelectorAll('.gift-box');
			giftBoxes.forEach((box) => {
				box.addEventListener('click', () => {
					const giftId = box.getAttribute('data-gift-id');
					if (giftId && window.showImageModal) {
						// ä»é…ç½®ä¸­è·å–å›¾ç‰‡è·¯å¾„
						const imageUrl = giftImageMap[giftId];
						if (imageUrl) {
							window.showImageModal(imageUrl);
						}
					}
					
					// æ·»åŠ ç‚¹å‡»åŠ¨ç”»
					box.classList.add('animating');
					setTimeout(() => {
						box.classList.remove('animating');
					}, 500);
				});
			});
		});
	</script>
</body>
</html>

